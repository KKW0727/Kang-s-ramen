<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.kangsRamen.model.dao.ReservationDao">
	<insert id="InsertReservationMst"
		parameterType="com.spring.kangsRamen.model.json.ReservationVo">
		insert into
			reservation_mst
		values(
			#{id},
			#{reservation_code},
			#{date},
			#{time},
			#{adult},
			#{child},
			#{seat},
			now(),
			now()
		)
	</insert>

	<insert id="InsertReservationDtl"
		parameterType="com.spring.kangsRamen.model.json.ReservationVo">
		insert into
			reservation_dtl
		values(
			#{reservation_code},
			#{karaiRamen},
			#{shoyu},
			#{miso},
			#{tonkotsu},
			#{discount},
			#{price},
			#{payment}
		)
	</insert>
	
	<select id ="getMaxReservationCode" resultType="String">
		select
  			max(reservation_code)
		from
 			reservation_mst
    </select>
    
     <select id="getAllReservation" resultType="com.spring.kangsRamen.model.json.ReservationVo">
        select
   			rm.id, rm.reservation_code,rm.date,rm.time,rm.adult,rm.child,rm.seat,rm.create_date,rm.update_date,
   			rd.karaiRamen,rd.shoyu,rd.miso,rd.tonkotsu,rd.discount,rd.price,rd.payment	
		from
   			reservation_mst rm
     		left outer join reservation_dtl rd on(rm.reservation_code = rd.reservation_code)
		where
   			rm.id = #{id};
   	</select>  

    <update id="updatePayment">
    	update
			reservation_dtl
		set 
			payment = '決済完了'
		where 
			reservation_code = #{id};
    </update>
   
</mapper>